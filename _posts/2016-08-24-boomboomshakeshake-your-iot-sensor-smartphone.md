---
ID: 3306
post_title: 'BoomBoomShakeShake&#8230;. &#8211; your IoT Sensor (Smartphone)'
author: RomeoKienzler
post_date: 2016-08-24 13:30:42
post_excerpt: |
  >
    This is a fun little game you can do
    with your friends and colleagues! Just
    have them open a URL on their smartphone
    to stream accelerometer data to the
    cloud. Then, everybody just has to shake
    their device very hard and the one
    creating the most energy wins.
layout: post
permalink: >
  https://nextstage.torolab.ibm.com/iotplatform/2016/08/24/boomboomshakeshake-your-iot-sensor-smartphone/
published: true
---
<p align="left">This is a fun little game you can do with your friends and colleagues! Just have them open a URL on their smartphone to stream accelerometer data to the cloud. Then everybody just has to shake their device very hard and the one creating the most energy wins. <br /><br />Interested? Here are some steps for how to do it:</p><ol><li><p align="left">Sign up for a <a href="http://ibm.biz/joinIBMCloud">free</a> IBM Cloud account</p></li><li><p align="left">Deploy the application using one-click deployment</p></li><li><p align="left">Stream the data into a relational database system</p></li><li><p align="left">Run an R-script that tells you who the winner is</p></li></ol><h3 class="western" align="left">Sign up for a <a href="http://ibm.biz/joinIBMCloud">free</a> IBM Cloud account</h3><p align="left">IBM Bluemix is the IBM PaaS Cloud.  A free trial is offered to everyone, but IBM also lets you use the cloud on a limited basis for free without paying anything. So you also can run this demo once the 30-day trial expires.</p><h3 class="western" align="left">Deploy the application using one-click deployment</h3><p align="left">Once you have a Bluemix account in place, you can deploy the application in just one click:</p><ol><li><p align="left">Open this <a target="_blank" href="https://discover-iot.eu-gb.mybluemix.net/#/try/">URL<br /> </a><a href="https://discover-iot.eu-gb.mybluemix.net/#/try/"> <span style="color: #000080;" color="#000080"> </span> </a> <a href="https://discover-iot.eu-gb.mybluemix.net/#/try/"></a><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled-300x162.png" alt="Untitled" class="alignnone size-medium wp-image-3308" height="162" width="300" /></a></p></li><li><p align="left">Click on "Deploy my App"<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled1.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled1-300x252.png" alt="Untitled" class="alignnone size-medium wp-image-3310" height="252" width="300" /></a></p></li><li><p align="left">Click on "Deploy"<br /> <a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled2.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled2-289x300.png" alt="Untitled" class="alignnone size-medium wp-image-3311" height="300" width="289" /></a><br /> Once finished, you can already send accelerometer data into the cloud. Please note down the application name because it will be part of the URL you have to use. Actually in my case the URL I'll give to my colleagues will be discover-iot-sample-romeokienzler-1412.mybluemix.net/iot-phone. <br /><br />While you can send data to the cloud, it won't get stored, so let's cover that in the next steps.</p></li><li><p align="left">We'll use NodeRED, an open source graphical flow editor to subscribe to the MQTT data coming from the smart phones and store it to the database. Therefore, we have to create a NodeRED instance: <br /><br /><a href="https://new-console.ng.bluemix.net/catalog/starters/node-red-starter/">https://new-console.ng.bluemix.net/catalog/starters/node-red-starter/</a></p></li><li><p align="left">Just put a unique name into "app name" (it has to be unique (non-existent) on the mybluemix.net domain. So, if you use <em>abc</em> the URL of your application will be abc.mybluemix.net, which is currently free since I'm getting a 404 from it:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled3.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled3-300x228.png" alt="Untitled" class="alignnone size-medium wp-image-3312" height="228" width="300" /></a></p></li><li><p align="left">Click on "Create"</p></li><li><p align="left">Once finished click on "connections" and then on "connect new." Now, we will add a relational database to the application:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled4.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled4-300x49.png" alt="Untitled" class="alignnone size-medium wp-image-3313" height="49" width="300" /></a></p></li><li><p align="left">Search for "dashDB" (using the search field), and then click on it:<br /><br /> <a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled7.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled7-300x246.png" alt="Untitled" class="alignnone size-medium wp-image-3316" height="246" width="300" /></a></p></li><li><p align="left">Click on "create"</p></li><li><p align="left">Click on "restage".  Once it completes, it should look like this:<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled8.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled8-300x217.png" alt="Untitled" class="alignnone size-medium wp-image-3317" height="217" width="300" /></a><br /><br />Great, now we have everything in place to capture and store the data</p></li></ol><br /><br /><h3 class="western" align="left">Capture and store the data using NodeRED</h3><p align="left">So let's just double-check if data coming from our smart phone arrives in the cloud (the MQTT broker as a service - part of the IBM Watson IoT platform) by subscribing to them via NodeRED and just debugging them by streaming them to the NodeRED debug panel. For this you need to have a NodeRED instance up and running.</p><p align="left">You have to follow these steps in <a href="http://romeokienzler.blogspot.ch/2016/08/create-node-red-instance-in-bluemix.html" target="_blank">this blog</a> to install that.</p><ol><li><p align="left">Start your NodeRED instance by opening the URL &lt;yourUniqueName&gt;.mybluemix.net/red - where &lt;yourUniqueName&gt; is the one you've chosen in the previous step. You should see a little sample app:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled9.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled9-300x169.png" alt="Untitled" class="alignnone size-medium wp-image-3319" height="169" width="300" /></a></p></li><li><p align="left">Select all the nodes on the panel and click on delete, basically removing the sample app because we will create our own flow now.</p></li><li><p align="left">From the left hand palette, drag the IBM IoT input node (don't use the output node) and the debug node to the pane and connect them by clicking on the little connection circles on each node. The flow should look like this:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled10.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled10-300x245.png" alt="Untitled" class="alignnone size-medium wp-image-3320" height="245" width="300" /></a></p></li><li><p align="left">Double-click on the IoT node, select "Bluemix Service" under authentication and click on "done". This basically tells the node to get the credentials to connect to the MQTT broker via CloudFoundry credentials injection, which is a very handy feature because in the Bluemix UI the application is connected to the MQTT broker, that is the Watson IoT service. This is the same as you've connected dashDB to the application in the previous section:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled11.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled11-300x107.png" alt="Untitled" class="alignnone size-medium wp-image-3321" height="107" width="300" /></a></p></li><li><p align="left">Click on deploy and select the debug pane below the deploy button.</p></li><li><p align="left">Now use the name you've noted down in the previous section and open the app on your smart phone &lt;theNameYouHaveNotedDown&gt;.mybluemix.net/iot-phone. In my case, it is discover-iot-sample-romeokienzler-1412.mybluemix.net/iot-phone</p></li><li><p align="left">Provide an 8-character alphanumeric name. </p></li><li><p align="left">Provide an 8-character password only containing characters between a-z.</p></li><li><p align="left">On your smart phone you should see the following messages:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled12.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled12-300x158.png" alt="Untitled" class="alignnone size-medium wp-image-3322" height="158" width="300" /></a></p></li><li><p align="left">And finally in NodeRED you should see this debug output:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled13.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled13-132x300.png" alt="Untitled" class="alignnone size-medium wp-image-3323" height="300" width="132" /></a></p></li></ol><p align="left">Congratulations, we are almost done, now we have to only stream this data to the data base and analyze it.</p><p align="left"></p><h3 class="western" align="left">Stream IoT sensor data to a RDBMS (dashDB)</h3><p align="left">dashDB is really cool. It is based on the IBM DB2 BLU data warehouse engine using column store layout, compression, and vectorized processing for speeding things up. In addition, it also has a R execution engine that we will use to calculate the winner, so stay tuned!</p><ol><li><p align="left">From the NodeRED panel select the "function" node because we have to flatten the hierarchical JSON messages to a relational scheme first. Just put it in between the two existing nodes and connect accordingly, so that the result looks like this:<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled14.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled14-300x75.png" alt="Untitled" class="alignnone size-medium wp-image-3325" height="75" width="300" /></a></p></li><li><p align="left"> Double-click on the function node and insert the following JavaScript code:<br /> msg.payload =<br /> {<br />    X : msg.payload.d.ax,<br />    Y : msg.payload.d.ax,<br />    Z : msg.payload.d.ax,<br />    SENSORID : msg.payload.d.id<br /> }<br /> return msg;<br /><br />So the final result should look like this:<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled15.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled15-300x177.png" alt="Untitled" class="alignnone size-medium wp-image-3327" height="177" width="300" /></a></p></li><li><p align="left"> Click on "done" and click "deploy" . On the debug pane, the output should look like this:<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled16.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled16-300x116.png" alt="Untitled" class="alignnone size-medium wp-image-3328" height="116" width="300" /></a><br /><br />Now we are prepared to store the data in a relational database.</p></li></ol><h3 class="western" align="left">Prepare the table in dashDB </h3><p align="left">Note: All DB related names are case sensitive, please be aware to follow this exactly as described here.</p><ol><li><p align="left">  From the Bluemix console click on your application, then connections, and then on dashDB:<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled17.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled17-300x220.png" alt="Untitled" class="alignnone size-medium wp-image-3329" height="220" width="300" /></a></p></li><li><p align="left">Then click on "open"<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled18.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled18-300x70.png" alt="Untitled" class="alignnone size-medium wp-image-3330" height="70" width="300" /></a></p></li><li><p align="left">Click on "Run SQL", insert to following snippet of code, and click on RUN:</p><p align="left">CREATE TABLE SHAKESHAKE (SENSORID VARCHAR(23),X DECIMAL, Y DECIMAL, Z DECIMAL)</p><p align="left"><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled19.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled19-300x91.png" alt="Untitled" class="alignnone size-medium wp-image-3331" height="91" width="300" /></a><br /><br />The result should look like this:<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled20.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled20-300x50.png" alt="Untitled" class="alignnone size-medium wp-image-3333" height="50" width="300" /></a></p></li></ol><h3 class="western" align="left">Stream the data into dashDB</h3><ol><li><p align="left">Open NodeRED again</p></li><li><p align="left">From the left panel, choose the dashDB output connector (the one not having a grey circle on the right hand side), and connect it to the output of the function node:<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled21.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled21-300x88.png" alt="Untitled" class="alignnone size-medium wp-image-3334" height="88" width="300" /></a><br />  </p></li><li><p align="left">Double-click on the dashDB node, and select your DB service (There should only be one unless you've connected more than one dashDB to this application in the Bluemix console. Again, the IBM Cloud here is making use of cloudfoundry credential injection basically doing the job of configuring the DB endpoint for you.) Enter "SHAKESHAKE" as the destination table. Since the NodeRED schema now matches the DB schema everything is done in order to stream data into dashDB.<br /><br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled22.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled22-300x162.png" alt="Untitled" class="alignnone size-medium wp-image-3335" height="162" width="300" /></a></p></li><li><p align="left">Click on "done" then on "deploy"</p></li></ol><p align="left">Now it's time to check if data arrives in the table. Please ensure the app on your smart phone is still sending data which can also be checked on the debug pane of node red.</p><h3 class="western" align="left">Check for data arriving in the data base</h3><ol><li><p align="left">Return to the dashDB user interface, and click on "run sql".</p></li><li><p align="left">Enter the following SQL query, the result should look like this:<br /><br /> SELECT * from SHAKESHAKE<br /><a href="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled23.png"><img src="http://nextstage.torolab.ibm.com/iotplatform/wp-content/uploads/sites/24/2016/08/Untitled23-300x182.png" alt="Untitled" class="alignnone size-medium wp-image-3336" height="182" width="300" /></a><br />  </p></li></ol><p>Congratulation, now we can play the game</p><p>&nbsp;</p><h3 class="western" align="left">Play the game !!!</h3><ol><li><p align="left">Ask some friends or colleagues to open the smart phone app URL and tell them to enter a unique 8-digit alpha numeric device id and a 8-digit character only password (a-z)</p></li><li><p align="left">Once all are sending data to the cloud (you can verify this in NodeRED and in dashDB using the SQL query), ask them to shake their device as strong as possible in all directions.</p></li><li><p align="left">You can check for the winner using the following SQL statement in dashDB:<br /> SELECT SENSORID, SUM(X)+SUM(Y)+SUM(Z) as ENERGY from SHAKESHAKE group by SENSORID ORDER BY ENERGY DESC</p></li><li><p align="left">To start over just issue DELETE FROM SHAKESHAKE and you are ready for the next game</p></li></ol><p>This application can be left up and running so you can play it during your lunch breaks to stay awake after a heavy lunch!  :)</p><p align="left"></p><p align="left"></p><p align="left"></p>